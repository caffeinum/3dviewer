/*! 3dviewer 2014-12-04 */
function CanvasWrapper(a,b){var c=document.getElementById(a||"cvs");if(c){var d=c.getContext(b||"2d");d&&(this.context=d,this.canvas=c,this.fillRect=function(a,b,c,e){d.fillStyle="#000000",d.fillRect(a,b,c,e)},this.clear=function(){d.clearRect(0,0,c.width,c.height)},this.drawCircle=function(a,b,c,e){d.fillStyle=e,d.beginPath(),d.arc(a,b,c,0,2*Math.PI),d.fill()},this.drawImage=function(a,b,c,e,f,g,h,i,j){d.drawImage(a,b,c,e,f,g,h,i,j)},this.drawText=function(a){d.font="36px Verdana",d.fillStyle="#ffffff",d.fillText(a,500,400)},this.drawLine=function(a,b,c,e,f){return d.strokeStyle=f||"#ffffff",d.beginPath(),d.moveTo(a,b),d.lineTo(c,e),d.stroke(),Math.sqrt((a-c)*(a-c)+(b-e)*(b-e))},this.moveTo=function(a,b,c){d.strokeStyle=c||"#ffffff",d.beginPath(),d.moveTo(a,b)},this.lineTo=function(a,b){d.lineTo(a,b)},this.stroke=function(){d.stroke()},this.arc=function(a,b,c,e,f,g,h){d.beginPath(),d.moveTo(a,b),d.arcTo(c,e,f,g,h),d.stroke()})}}function getShader(a,b){var c=document.getElementById(b);if(!c)return null;for(var d="",e=c.firstChild;e;)3==e.nodeType&&(d+=e.textContent),e=e.nextSibling;var f;if("x-shader/x-fragment"==c.type)f=a.createShader(a.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!=c.type)return null;f=a.createShader(a.VERTEX_SHADER)}return a.shaderSource(f,d),a.compileShader(f),a.getShaderParameter(f,a.COMPILE_STATUS)?f:(alert(a.getShaderInfoLog(f)),null)}function echo(a){$("#output").text(a)}CanvasWrapper.prototype.init=function(){function a(){var a=getShader(d,"shader-fs"),b=getShader(d,"shader-vs");e=d.createProgram(),d.attachShader(e,b),d.attachShader(e,a),d.linkProgram(e),d.getProgramParameter(e,d.LINK_STATUS)||alert("Could not initialise shaders"),d.useProgram(e),e.vertexPositionAttribute=d.getAttribLocation(e,"aVertexPosition"),d.enableVertexAttribArray(e.vertexPositionAttribute),e.pMatrixUniform=d.getUniformLocation(e,"uPMatrix"),e.mvMatrixUniform=d.getUniformLocation(e,"uMVMatrix"),e.colourUniform=d.getUniformLocation(e,"uColour")}function b(){d.uniformMatrix4fv(e.pMatrixUniform,!1,i),d.uniformMatrix4fv(e.mvMatrixUniform,!1,h)}function c(){f=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,f);var a=[0,1,0,-1,-1,0,1,-1,0];d.bufferData(d.ARRAY_BUFFER,new Float32Array(a),d.STATIC_DRAW),f.itemSize=3,f.numItems=3,g=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,g),a=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],d.bufferData(d.ARRAY_BUFFER,new Float32Array(a),d.STATIC_DRAW),g.itemSize=3,g.numItems=4}var d=this.gl=this.context;d.viewportWidth=this.canvas.width,d.viewportHeight=this.canvas.height,a(d),c(d),d.clearColor(.9,.9,.9,1),d.enable(d.DEPTH_TEST);var e,f,g,h=mat4.create(),i=mat4.create();this.drawScene=function(a,c){d.viewport(0,0,d.viewportWidth,d.viewportHeight),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT),mat4.perspective(i,45,d.viewportWidth/d.viewportHeight,.1,100),mat4.identity(h),mat4.translate(h,h,[-1.5,0,-7]),mat4.translate(h,h,[1,0,0]),d.bindBuffer(d.ARRAY_BUFFER,g),d.vertexAttribPointer(e.vertexPositionAttribute,g.itemSize,d.FLOAT,!1,0,0),b(d),d.uniform4fv(e.colourUniform,c[a%c.length]),d.drawArrays(d.TRIANGLE_STRIP,0,g.numItems)}},$(document).ready(function(){var a=new CanvasWrapper("leftEye","experimental-webgl"),b=new CanvasWrapper("rightEye","experimental-webgl");a.init(),b.init();var c=0,d=!1,e=function(a){d=a};$("#output").mouseenter(function(){e(!0)}).mouseleave(function(){e(!1)});var f,g,h,i,j,k=0,l=$V([.2,.7,.7]),m=$V([-.7,.2,0]),n=.3;c=0,clearInterval(k),k=setInterval(function(){d||(m=m.add(l.cross(m).x(1/m.modulus()/l.modulus()/50)),m=m.x(n/m.modulus()),i=m,f=i.elements,g=l.elements,h=$V([g[0],g[1],g[2],1]).add($V([f[0],f[1],f[2],0])),a.drawScene(c,[h.elements]),j=m.x(-1),f=j.elements,h=$V([g[0],g[1],g[2],1]).add($V([f[0],f[1],f[2],0])),b.drawScene(c,[h.elements]),echo(" R: "+h.elements[0].toFixed(3)+" G: "+h.elements[1].toFixed(3)+" B: "+h.elements[2].toFixed(3)),console.log(h.elements),c++)},50/3)});